---
layout: post
title: "【PRD】思路模版配置"
author: "何心	
categories: internship
tags: [confidential]
published: false
image: internship-cover-3.png

---

## 1 变更记录

| **序号** | **日期**   | **变更人** | **修改内容** |
| -------- | ---------- | ---------- | ------------ |
|          | 2025/01/15 | 何心       | 新建文档     |

## **2 需求背景**

1. 准确意图下获取数据的准确率提升至90%是BA Copilot2025年的OP
2. 围绕UGC创新者模式，BA Copilot计划构建Data Box，即数据接入与语义化模块，对于接入的数据也需要保证90%的准确率
3. 产研对于意图识别Agent的目标达成一致，暂时只将思路模板配置开放给用户

## 3 需求目标

思路模板配置：提升智能服务水平的一项必要能力，服务于不同模块的定制化分析思路配置。

## 4 功能列表

| 模块               | 优先级         | 子模块                                                   | 主要功能                           |
| ------------------ | -------------- | -------------------------------------------------------- | ---------------------------------- |
| 思路模板展示       | P0             | 模板列表                                                 | 展示配置的模板，可新增、修改、删除 |
| 思路模板工作流配置 | P0             | 默认画布展示内容                                         | 画布初始化展示信息                 |
| P0                 | 节点页面       | 可创建节点展示页面，点击节点后在画布中添加节点           |                                    |
| P0                 | 配置模板工作流 | 在画布中配置工作流，包括触发规则及对应工作流             |                                    |
| P0                 | 流程预览       | 试运行时会按配置规则进行配置校验，若无错误可进行效果预览 |                                    |
| P0                 | 模板发布       | 发布配置成功的模板，回写模板信息至MBA                    |                                    |

## 5 产品方案

### 5.1 产品方案

| **页面**         | **功能说明**                                                 | **原型图**                                                   | **UI** |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------ |
| 思路模板展示页面 | 该页面为思路模板配置、管理页面，可新增、修改、删除规则。（图1）页面权限：展示用户具有**模块管理权限**的思路模板展示规则：默认展示用户拥有**模块管理权限**的全部模板可通过下拉框选中模块筛选模板，可多选，可全选，可搜索（图2）按照修改时间倒序展示字段说明：Module编号：如Module101、Module108Module名称：如场景化工序匹配、业务Cross分析模板编号：新建后会创建模板编号，唯一值模板名称：新建时用户会输入模板名称，10字以内模板描述：新建时用户会输入模板描述，50字以内，超长部分省略展示模板状态：分为草稿、已发布、已失效（databox指标维度变更后会触发）规则优先级：模板的优先级配置，当同时满足时确认执行优先级，数字越小优先级越高更新时间：模板创建/修改的最新时间更新人：模板创建/修改的更新人MISIDModule和规则的关系：同一个模块可配置多个模板，已发布的模板会在MBA中回写至模块配置中增删改新建：点击【新建思路模板】后，弹窗新建模板页面（图3），点击确定后，进入进入此工作流配置页面删除：点击【删除】后，展示弹窗提示是否确认删除此工作流，确认后才可删除，弹窗内容：（图4）删除并跳转至模板配置：点击后删除此模板并且跳转至MBA思路模板配置页删除后不会对线上在行模板有影响，需重新发布线上才会生效MBA思路模板配置页中已删除的模板右上角展示提示icon，需要解除绑定后才可以重新发布修改：点击【修改】后，进入此工作流配置页面 | 图1：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146803256485?contentType=1&isNewContent=false)图2：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146672695062?contentType=1&isNewContent=false)图3：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146801897078?contentType=1&isNewContent=false)图4：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146931992372?contentType=1&isNewContent=false) |        |
| 默认画布         | 该页面为思路模板的规则及工作流配置页面，可通过画布的形式自定义节点及单个节点中的配置。展示内容：（图1）模块、模板信息：注：需要Module管理员在MBA平台新建并保存模块相关基础信息、关联databox相关数据后此处新建后才能获取对应模块信息。MBA获取的模板是此处发布过的模板当前模板的模版名称：点击可修改模块名称：模板关联的模块id+名称模块对应的模板名称：下拉框，可单选，切换后会弹窗是否确认切换至其他模板，切换后当前模板自动保存开始节点：开始节点是工作流的起始节点，需要包含if条件信息作为触发条件结束节点：结束节点是工作流的末尾节点，用于返回工作流的运行结果添加节点：点击可以展开弹窗页面（图2），页面展示可添加的节点，可点击或拖拽至画布（图3）放大、缩小、展开画布：点击【+】放大10%，点击【-】缩小10%，点击展开全屏画布，按ESC返回撤回：撤销上一步配置重置：可清空当前页面的所有配置，点击后弹窗确认是否确认重置，确认后才可重置试运行：点击后校验当前页面是否有配置错误，若有则弹窗节点配置检查页面（图4），当前配置均无问题后，点击试运行可弹窗预览页面（图5），预览页面可折叠发布：点击后校验当前页面是否有配置错误，若有则弹窗节点配置检查页面（图4），当前配置均无问题后，点击发布可发布此模板，发布过的模板会回写至MBA中的模板关联页面其他组件能力：如按住拖动等保存逻辑：当用户切换模板/退出配置时，会保存当前全部配置内容 | 图1：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146790394041?contentType=1&isNewContent=false)图2：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146802403699?contentType=1&isNewContent=false)图3：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146818228837?contentType=1&isNewContent=false)图4：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146808832982?contentType=1)图5：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146811548652?contentType=1&isNewContent=false) |        |
| 节点页面         | 该页面为点击【添加节点】按钮后弹窗展示的页面，包含所有节点内容及简介。点击或拖拽任意节点可添加节点至画布，右侧弹窗展示、配置节点相关信息。节点介绍可参考【5.2节点介绍】节点分类及简介：（图1）开始节点：工作流的起始节点，需要包含if条件信息作为触发条件结束节点：工作流的末尾节点，用于返回工作流的运行结果条件节点：根据输入scheme结果判断是否满足条件文本节点：前端直接展示文本内容SQL节点：可配置SQL取数逻辑Python节点：可通过文本输入的形式输入分析思路洞察分析节点：对截至到目前节点的数据的洞察分析绘图节点：可通过文本输入/勾选前端组件的形式说明需要输出的图表要求节点依赖：在页面配置不满足节点相关的依赖条件时，点击试运行、发布时，试运行会弹窗报错条件分支：必须有if条件，且if、else两条分支都有下游节点文本节点：无依赖项SQL取数：无依赖项Python分析：依赖SQL取数和分析节点，若上游无SQL取数，则提示不可新建Python分析节点洞察分析：依赖SQL取数、Python分析、洞察分析节点，若上游无相关节点，则提示不可新建洞察分析节点绘图：依赖SQL取数或Python分析节点，若上游无SQL取数或Python分析节点，则提示不可新建绘图节点其他说明：流程首尾不可相连，避免流程进入循环无法停止 | 图1：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146815663682?contentType=1&isNewContent=false) |        |
| 流程预览         | 预览规则：当页面配置无错误时，点击试运行可以对当前配置进行调试，否则展示节点配置检查页面，试运行按钮置灰调试过程：输入query后会按照左侧配置展示返回流程编排结果展示内容：模板信息调试过程信息输入框、发送按钮发布按钮 | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146808505777?contentType=1&isNewContent=false) |        |
| 模板发布         | 发布规则：当页面配置无错误时，点击发布可以对当前配置进行发布，否则展示节点配置检查页面，发布按钮置灰当模板试运行成功后才可发布，未试运行时按钮置灰发布后：模板创建后发布：回写信息至MBA模板配置List中，草稿状态的模板不会展示。模板更新后发布：识别模板无节点错误后，点击发布对线上生效数据集变更的时候databox提示影响的模板信息，如果造成节点错误直接置为失效，如果节点没错就不会失效 |                                                              |        |

### 5.2 节点介绍

工作流配置由多个节点构成，节点是组成工作流的基本单元。例如，SQL、Python、文本等节点。

工作流默认包含了**开始**节点和**结束**节点。

明细可随组件功能有所调整，但需保持基础功能

|      | 模块     | 节点名称                                                     | 示意图                                                       | 节点描述                                                     | 节点明细                                                     |
| ---- | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
|      | 默认节点 | 开始节点                                                     | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146819644484?contentType=1&isNewContent=false) | 开始节点是工作流的起始节点，包含触发条件                     | 符合任意/所有条件时执行条件参数：下拉框可单选用户query指标维度条件关系：包含、不包含、开始是、结束是、是、不是、为空、不为空比较值：下拉框可单选文本内容，选中后比较值为输入框指标维度 |
|      | 结束节点 | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146819024181?contentType=1&isNewContent=false) | 结束节点是工作流的终止节点，可对输出结果排序或删除           | 输出参数注释：输出参数和回复内容至少填写其一（推荐填写回复内容）可拖拽展示顺序回复内容注释：最多可配置3条回复内容，每次会随意一条进行回复输出参数和回复内容至少填写其一（推荐填写回复内容） |                                                              |
|      | 基础节点 | 条件节点                                                     | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146819350385?contentType=1&isNewContent=false) | 根据输入scheme结果判断是否满足条件                           | IF和ELS下游E有两个节点，对应两个工作流参数：下拉框可单选用户query指标维度条件关系：包含、不包含、开始是、结束是、是、不是、为空、不为空比较值：下拉框可单选文本内容，选中后比较值为输入框指标维度 |
|      | 文本节点 | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146814868722?contentType=1&isNewContent=false) | 前端直接展示文本内容，主要是为了加title                      | 沿用文字相关配置组件即可                                     |                                                              |
|      | 取数节点 | 图1：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146983072371?contentType=1&isNewContent=false)图2：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146992696228?contentType=1&isNewContent=false)图3：![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146995064400?contentType=1&isNewContent=false) | 可配置取数内容，如时间、指标、维度、维值，其中指标维度维值从databox数据源获取。可以自定义输入SQL，可选择是否输出scheme、该节点在前端是否展示 | 自定义sql：输入sql后点击预览仅校验语法错误SQL涉及表权限提示（图2）预览功能：预览出sql执行结果（图3）配置sql：可通过添加要素新增行，切换要素的指标、维度、指标等 |                                                              |
|      | 分析节点 | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146964251324?contentType=1&isNewContent=false) | 可通过文本输入的形式输入分析思路如：以上每个指标在每个维度的占比 |                                                              |                                                              |
|      | 洞察节点 | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146955147173?contentType=1&isNewContent=false) | 对截至到目前节点的数据的洞察分析，可对配洞察总结提示词配置   | 模板：点击可以选中预设的模板并复制至输入框中                 |                                                              |
|      | 绘图节点 | ![image.jpeg](https://km.sankuai.com/api/file/cdn/2702355196/146821353878?contentType=1&isNewContent=false) | 可通过文本输入/勾选前端组件的形式说明需要输出的图表要求，如：根据cross指数画堆叠图，横轴为业务，纵轴为cross指数 | 描述或选择，补充一个即可                                     |                                                              |
